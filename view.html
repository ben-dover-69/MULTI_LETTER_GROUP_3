<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>View Letter</title>
<link rel="stylesheet" href="https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- ======== ADDITIONAL STYLES ======== -->
<style>
/* Title animation */
#title {
  opacity: 0;
  transform: translateY(-20px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
#title.show {
  opacity: 1;
  transform: translateY(0);
}

/* Wax seal initials */
.waxSeal span {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  font-size: 22px;
  color: white;
}

/* Cursive font for love letters */
body.love .letter {
  font-family: 'Cormorant Garamond', cursive;
}

/* Music button symbols */
#musicToggle {
  font-family: 'Playfair Display', serif;
  font-weight: bold;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
#musicToggle.playing::before { content: '❚❚'; }
#musicToggle.paused::before { content: '►'; }
</style>
</head>
<body class="love">

<!-- ENVELOPE -->
<div id="envelopeScreen">
  <div class="envelope">
    <div class="env-back"></div>
    <div class="env-front"></div>
    <div class="env-flap"></div>
  </div>
  <button id="openLetterBtn">Open Letter</button>
</div>

<!-- MAIN VIEW -->
<div id="app" class="hidden">

  <!-- LETTER -->
  <div class="letter-container">
    <div id="letter" class="letter">
      <p class="date" id="date"></p>
      <p class="dear">Dear <span id="receiverName" class="editable-box" contenteditable="false">Receiver Name</span>,</p>
      <h1 id="title">Letter Title</h1>
      <div id="body" class="body editable-box" contenteditable="false">
        This is the body of the letter.
      </div>
      <p class="closing">Sincerely,<br>
        <span id="senderName" class="editable-box" contenteditable="false">Sender Name</span>
      </p>
      <div id="waxSeal" class="waxSeal"><span id="waxInitials"></span></div>
    </div>
  </div>

  <!-- BOTTOM CONTROLS -->
  <div class="bottom-controls">
    <div class="action-buttons">
      <button id="exportBtn">Export PDF</button>
      <button id="musicToggle"> Play Music</button>
    </div>
  </div>
</div>

<audio id="music" loop src="https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/kuped.mp3"></audio>

<script>
  // ELEMENTS
  const openBtn = document.getElementById("openLetterBtn");
  const envelope = document.querySelector(".envelope");
  const envelopeScreen = document.getElementById("envelopeScreen");
  const app = document.getElementById("app");
  const waxSeal = document.getElementById("waxSeal");
  const waxInitials = document.getElementById("waxInitials");
  const letter = document.getElementById("letter");
  const music = document.getElementById("music");
  const musicToggle = document.getElementById("musicToggle");
  const exportBtn = document.getElementById("exportBtn");
  const dateEl = document.getElementById("date");
  const titleEl = document.getElementById("title");

  // DATE
  dateEl.textContent = new Date().toDateString();

  // MUSIC FILES
  const musicFiles = {
    love: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/kuped.mp3",
    birthday: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/bdaysmegs.mp3",
    formal: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/peynknwite.mp3",
    informal: "",
    invitation: "",
    apology: "",
    farewell: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/farewell.mp3"
  };

  // ===============================
  // READ LETTER DATA FROM URL
  // ===============================
  const params = new URLSearchParams(window.location.search);
  const receiver = params.get("receiver");
  const title = params.get("title");
  const body = params.get("body");
  const sender = params.get("sender");
  const type = params.get("type");

  if (receiver) document.getElementById("receiverName").textContent = decodeURIComponent(receiver);
  if (title) titleEl.textContent = decodeURIComponent(title);
  if (body) document.getElementById("body").innerHTML = decodeURIComponent(body).replace(/\n/g, "<br>");
  if (sender) document.getElementById("senderName").textContent = decodeURIComponent(sender);
  if (type) document.body.className = type;

  // WAX INITIALS
  if (sender) {
    const initials = decodeURIComponent(sender).split(' ').map(n => n[0].toUpperCase()).join('');
    waxInitials.textContent = initials;
  }

  // OPEN ENVELOPE
  openBtn.onclick = () => {
    envelope.classList.add("open");
    const flap = document.querySelector(".env-flap");
    flap.style.transition = "transform 0.7s ease";
    flap.style.transform = "rotateX(180deg)";

    setTimeout(() => {
      envelopeScreen.style.display = "none";
      app.classList.remove("hidden");

      // Show wax seal
      setTimeout(() => waxSeal.classList.add("show"), 1000);

      // Animate title
      titleEl.classList.add("show");

      // Play music based on letter type
      const currentType = document.body.className;
      music.src = musicFiles[currentType] || musicFiles.love;
      music.play();
      updateMusicButton();
    }, 700);
  };

  // ===============================
  // MUSIC BUTTON
  // ===============================
  function updateMusicButton() {
    if (music.paused) {
      musicToggle.classList.remove('playing');
      musicToggle.classList.add('paused');
      musicToggle.textContent = ' Play Music';
    } else {
      musicToggle.classList.remove('paused');
      musicToggle.classList.add('playing');
      musicToggle.textContent = ' Pause Music';
    }
  }

  musicToggle.onclick = () => {
    if (music.paused) music.play();
    else music.pause();
    updateMusicButton();
  };
  updateMusicButton();

  // ===============================
  // EXPORT PDF
  // ===============================
  exportBtn.onclick = () => html2pdf().from(letter).save("letter.pdf");
</script>

</body>
</html>