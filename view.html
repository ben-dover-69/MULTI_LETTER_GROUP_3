<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>View Letter</title>
<link rel="stylesheet" href="https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* Title animation */
.letter h1 {
  opacity: 0;
  transform: translateY(-20px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
.letter h1.show {
  opacity: 1;
  transform: translateY(0);
}

/* Wax seal initials */
.waxSeal span {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  font-size: 22px;
  color: white;
}

/* Music button symbols */
#musicToggle {
  font-family: 'Playfair Display', serif;
  font-weight: bold;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
#musicToggle.playing::before { content: '‚ùö‚ùö'; }
#musicToggle.paused::before { content: '‚ñ∫'; }

/* Hide all letters by default */
.letter.hidden { display: none; }

/* Letter fonts per type */
body.love .letter { font-family: 'Cormorant Garamond', cursive; }
body.birthday .letter { font-family: 'Libre Baskerville', serif; }
body.formal .letter { font-family: 'Cormorant Garamond', serif; }
body.informal .letter { font-family: 'Libre Baskerville', serif; }
body.invitation .letter { font-family: 'Playfair Display', serif; }
body.apology .letter { font-family: 'Cormorant Garamond', serif; }
body.farewell .letter { font-family: 'Libre Baskerville', serif; }
</style>
</head>
<body class="love">

<!-- ENVELOPE -->
<div id="envelopeScreen">
  <div class="envelope">
    <div class="env-back"></div>
    <div class="env-front"></div>
    <div class="env-flap"></div>
  </div>
  <button id="openLetterBtn">Open Letter</button>
</div>

<!-- MAIN VIEW -->
<div id="app" class="hidden">

  <!-- LETTERS -->
  <div class="letter-container">
    <!-- Love Letter -->
    <div id="letter-love" class="letter hidden">
      <p class="date"></p>
      <p class="dear">Dear <span class="receiverName editable-box" contenteditable="false">Someone Special</span>,</p>
      <h1 class="title">A Letter From My Heart üíñ</h1>
      <div class="body editable-box" contenteditable="false">This letter is written with love and sincerity...</div>
      <p class="closing">Sincerely,<br><span class="senderName editable-box" contenteditable="false">Your Name</span></p>
      <div class="waxSeal"><span class="waxInitials"></span></div>
    </div>

    <!-- Birthday Letter -->
    <div id="letter-birthday" class="letter hidden">
      <p class="date"></p>
      <p class="dear">Dear <span class="receiverName editable-box" contenteditable="false">Someone</span>,</p>
      <h1 class="title">Happy Birthday Wishes üéâ</h1>
      <div class="body editable-box" contenteditable="false">Wishing you a day full of joy and surprises!</div>
      <p class="closing">Sincerely,<br><span class="senderName editable-box" contenteditable="false">Your Name</span></p>
      <div class="waxSeal"><span class="waxInitials"></span></div>
    </div>

    <!-- Formal Letter -->
    <div id="letter-formal" class="letter hidden">
      <p class="date"></p>
      <p class="dear">Dear <span class="receiverName editable-box" contenteditable="false">Recipient</span>,</p>
      <h1 class="title">A Formal Letter üìù</h1>
      <div class="body editable-box" contenteditable="false">This letter is written to formally communicate an important matter.</div>
      <p class="closing">Sincerely,<br><span class="senderName editable-box" contenteditable="false">Your Name</span></p>
      <div class="waxSeal"><span class="waxInitials"></span></div>
    </div>

    <!-- Informal Letter -->
    <div id="letter-informal" class="letter hidden">
      <p class="date"></p>
      <p class="dear">Dear <span class="receiverName editable-box" contenteditable="false">Friend</span>,</p>
      <h1 class="title">Just Saying Hello üëã</h1>
      <div class="body editable-box" contenteditable="false">Just sharing some casual thoughts and greetings.</div>
      <p class="closing">Sincerely,<br><span class="senderName editable-box" contenteditable="false">Your Name</span></p>
      <div class="waxSeal"><span class="waxInitials"></span></div>
    </div>

    <!-- Invitation Letter -->
    <div id="letter-invitation" class="letter hidden">
      <p class="date"></p>
      <p class="dear">Dear <span class="receiverName editable-box" contenteditable="false">Friend</span>,</p>
      <h1 class="title">You‚Äôre Invited üéÄ</h1>
      <div class="body editable-box" contenteditable="false">We would love for you to join us at this special event.</div>
      <p class="closing">Sincerely,<br><span class="senderName editable-box" contenteditable="false">Your Name</span></p>
      <div class="waxSeal"><span class="waxInitials"></span></div>
    </div>

    <!-- Apology Letter -->
    <div id="letter-apology" class="letter hidden">
      <p class="date"></p>
      <p class="dear">Dear <span class="receiverName editable-box" contenteditable="false">Recipient</span>,</p>
      <h1 class="title">A Sincere Apology üôè</h1>
      <div class="body editable-box" contenteditable="false">I am deeply sorry and hope you can forgive me.</div>
      <p class="closing">Sincerely,<br><span class="senderName editable-box" contenteditable="false">Your Name</span></p>
      <div class="waxSeal"><span class="waxInitials"></span></div>
    </div>

    <!-- Farewell Letter -->
    <div id="letter-farewell" class="letter hidden">
      <p class="date"></p>
      <p class="dear">Dear <span class="receiverName editable-box" contenteditable="false">Friend</span>,</p>
      <h1 class="title">Saying Goodbye üëã</h1>
      <div class="body editable-box" contenteditable="false">This letter is to say farewell with gratitude and memories.</div>
      <p class="closing">Sincerely,<br><span class="senderName editable-box" contenteditable="false">Your Name</span></p>
      <div class="waxSeal"><span class="waxInitials"></span></div>
    </div>
  </div>

  <!-- BOTTOM CONTROLS -->
  <div class="bottom-controls">
    <div class="action-buttons">
      <button id="exportBtn">Export PDF</button>
      <button id="musicToggle"> Play Music</button>
    </div>
  </div>
</div>

<audio id="music" loop></audio>

<script>
const openBtn = document.getElementById("openLetterBtn");
const envelope = document.querySelector(".envelope");
const envelopeScreen = document.getElementById("envelopeScreen");
const app = document.getElementById("app");
const music = document.getElementById("music");
const musicToggle = document.getElementById("musicToggle");
const exportBtn = document.getElementById("exportBtn");

// ===============================
// LETTERS & CONTENT
// ===============================
const params = new URLSearchParams(window.location.search);
const receiver = decodeURIComponent(params.get("receiver") || "");
const title = decodeURIComponent(params.get("title") || "");
const body = decodeURIComponent(params.get("body") || "");
const sender = decodeURIComponent(params.get("sender") || "");
const type = params.get("type") || "love";

document.body.className = type;

// Select the correct letter box
const letters = document.querySelectorAll(".letter");
letters.forEach(l => l.classList.add("hidden"));
const activeLetter = document.getElementById(`letter-${type}`);
activeLetter.classList.remove("hidden");

// Set content dynamically
activeLetter.querySelector(".receiverName").textContent = receiver || activeLetter.querySelector(".receiverName").textContent;
activeLetter.querySelector(".title").textContent = title || activeLetter.querySelector(".title").textContent;
activeLetter.querySelector(".body").innerHTML = body.replace(/\n/g,"<br>") || activeLetter.querySelector(".body").innerHTML;
activeLetter.querySelector(".senderName").textContent = sender || activeLetter.querySelector(".senderName").textContent;
activeLetter.querySelector(".date").textContent = new Date().toDateString();

// Wax initials
const waxInitial = sender.split(' ').map(n => n[0].toUpperCase()).join('');
activeLetter.querySelector(".waxInitials").textContent = waxInitial;

// Music files
const musicFiles = {
  love: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/kuped.mp3",
  birthday: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/bdaysmegs.mp3",
  formal: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/peynknwite.mp3",
  informal: "",
  invitation: "",
  apology: "",
  farewell: "https://ben-dover-69.github.io/MULTI_LETTER_GROUP_3/farewell.mp3"
};

// ===============================
// OPEN ENVELOPE
// ===============================
openBtn.onclick = () => {
  envelope.classList.add("open");
  document.querySelector(".env-flap").style.transform = "rotateX(180deg)";

  setTimeout(() => {
    envelopeScreen.style.display = "none";
    app.classList.remove("hidden");

    // Show wax seal
    setTimeout(() => activeLetter.querySelector(".waxSeal").classList.add("show"), 1000);

    // Animate title
    activeLetter.querySelector(".title").classList.add("show");

    // Play music
    music.src = musicFiles[type] || musicFiles.love;
    music.play();
    updateMusicButton();
  }, 700);
};

// ===============================
// MUSIC BUTTON
// ===============================
function updateMusicButton() {
  if (music.paused) {
    musicToggle.classList.remove('playing');
    musicToggle.classList.add('paused');
    musicToggle.textContent = ' Play Music';
  } else {
    musicToggle.classList.remove('paused');
    musicToggle.classList.add('playing');
    musicToggle.textContent = ' Pause Music';
  }
}

musicToggle.onclick = () => {
  if (music.paused) music.play();
  else music.pause();
  updateMusicButton();
};
updateMusicButton();

// ===============================
// EXPORT PDF
// ===============================
exportBtn.onclick = () => html2pdf().from(activeLetter).save("letter.pdf");
</script>

</body>
</html>